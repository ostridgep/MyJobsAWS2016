<!DOCTYPE html>
<html  manifest="cache.manifest" xmlns="http://www.w3.org/1999/xhtml">
    <!--<html xmlns="http://www.w3.org/1999/xhtml">-->
    <head>
        <link href="css/site.css" rel="stylesheet" />
        <script src="js/jq.1.10.2.js"></script>
        <script src="js/jqui.1.9.2.js"></script>
        <script src="js/bs.3.1.1.js"></script>
        <script src="js/functions.js"></script>
		<script type="text/javascript" src="cordova.js"></script>
        <link rel="stylesheet" href="css/bs.3.1.1.css" />
        <link rel="stylesheet" href="css/jqui.1.9.2_smoothness.css" />
        


        <!--<script language="JavaScript">
            $(document).ready(function () {
                var thisURL = document.URL;
                var urlArray = thisURL.split("?");
                var cleanArray = urlArray[1].split("&");

                $.each(cleanArray, function (index, value) {
                    var thisQS = value;
                    var QSarray = thisQS.split("=");
                    var thisValue = QSarray[index, 1];
                    var thisProp = QSarray[index, 0];

                    $('#' + thisProp + '').val(thisValue);
                });


                //set headers for W-orker & Func loc
                $('#workorderlabel').text($('#workorder').val());
                $('#functionallocationlabel').text($('#functionallocation').val().toUpperCase());

            });
        </script>-->


        <title>Flooding/DG5 Feedback</title>
    </head>
    <body >




        <div class="container">
            <div class="well row" style="margin-top: 10px">
                <div class="col-md-6">
                    <div class="row">
                        <a href="formsindex.html"><button class="btn btn-lg btn-info">Home</button></a>
                    </div>
                    <div class="row">
                        <h1><b>Flooding/DG5 Feedback Form</b></h1>
                    </div>
                </div>
                <form class="form-inline" id="MyJobsForm" method="get" action="ProcessForm.html">
            <div class="col-md-6">
                <div class="row">
				<input class="form-control" id="workorder" merge="orderno" placeholder="Enter Work Order"/>
                    <!--<label class="pull-right" id="workorderlabel"></label>-->
                </div>
                <div class="row">
				<input class="form-control" id="functionallocation" merge="funcloc_desc"  placeholder="Enter Functional Location"/>
                    <!--<label class="pull-right" id="functionallocationlabel"></label>-->
                </div>
            </div>

            </div>
            
            
            <input id="FormName" name="FormName" value="Flooding" hidden>
                <div class="form-group">
                    <div class="well row">
                        <div class="col-md-6 col-sm-6">
                            <input name="attendancedate" type="text" class="feedback-input" placeholder="Attendance Date" id="attendancedate" readonly />

                            
                            <select class="feedback-input" id="attendanceweather" name="attendanceweather" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='ATW' AND LEVEL='2' ORDER BY CODEDESC">
                    	 
                         
                           			<option value="" disabled selected>Attendance Weather</option>
                          

                        	</select> 
                        </div>

                        <div class="col-md-6 col-sm-6">
                            <input name="flooddate" type="text" class="feedback-input hideOnLoad" placeholder="Flood Date" id="flooddate" readonly/>
                         
                            
                            <select class="hideOnLoad feedback-input" id="floodweather" name="floodweather" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='FLW' AND LEVEL='2' ORDER BY CODEDESC">
                    	 
                         
                           			<option value="" disabled selected>Attendance Weather</option>
                          

                        	
                            </select>
                        </div>
                    </div>

                    <div class="well row">
                        <div class="row ccol-md-6 col-sm-8">
                            <select class="feedback-input cause" id="previousflooding" name="previousflooding" style="margin-left: 20px" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='IPF' AND LEVEL='2' ORDER BY CODEDESC">
                                <option value="" disabled selected>Is there any indication of previous flooding?</option>
                                
                            </select>

                        </div>
                        <div class="row col-md-12 col-sm-12">
                             <label style="margin-left: 16px" type="text" class="feedback-input col-md-9 col-sm-8">Has flooding caused pollution with measureable impact?</label>
                            <div class="btn-group btn-toggle col-md-2 col-sm-3" id="measurableimpact">
                                <button type="button" class="btn btn-lg btn-default">Yes</button>
                                <button type="button" class="btn btn-lg btn-primary active">No</button>
                            </div>
                        </div>
                    </div>

                    <div class="well row">
                        <div class="col-md-6 col-sm-6">
                            <select class="feedback-input" id="floodingsource" name="floodingsource" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='FSO' AND LEVEL='2' ORDER BY CODEDESC">
                                <option value="" disabled selected>Flooding Source</option>

                            </select>

                            <select class="feedback-input cause" id="causeofflood" name="causeofflood" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='CAU' AND LEVEL='2' ORDER BY CODEDESC" 
                             onChange="parent.buildRelatedSelect('rootcause','select code as value, CODEDESC as description from DG5CODES   where  type = \'DF\' AND coderef=\'RCA\' AND LEVEL=\'2\' AND code LIKE ',this.value+'%')">
                       
                                <option value="" disabled selected>Cause of Flood</option>

                            </select>

                            <select class="feedback-input root" id="rootcause" name="rootcause" >
                                <option class="blockage" disabled selected>Root Cause</option>

                            </select>
                        </div>

                        <div class="col-md-6 col-sm-6">
                            <select class="feedback-input" id="spillsize" name="spillsize" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='SPS' AND LEVEL='2' ORDER BY CODEDESC">
                                <option value="" disabled selected>Spill Size</option>

                            </select>

                            <select class="feedback-input" id="sewerstatus" name="sewerstatus" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='SWS' AND LEVEL='2' ORDER BY CODEDESC">
                                <option value="" disabled selected>Sewer Status</option>

                            </select>

                            <select class="feedback-input" id="sewertype" name="sewertype" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DF' AND coderef='SWT' AND LEVEL='2' ORDER BY CODEDESC">
                                <option value="" disabled selected>Sewer Type</option>

                            </select>
                        </div>
                    </div>
                    <div class="well row">
                        <div class="col-md-4 col-sm-4">
                            <input name="psshortcode" type="text" class="feedback-input" placeholder="PS Short Code" id="psshortcode" />
                        </div>
                        <div class="col-md-4 col-sm-4">
                            <input name="assetref" type="text" class="feedback-input" placeholder="Asset Ref" id="assetref" />
                        </div>
                        <div class="col-md-4 col-sm-4">
                            <input name="gridref" onclick= "openGoogleMapsGetLocation('../GoogleMapsGetLocation.html')" type="text" class="feedback-input" placeholder="Grid Ref" id="gridref" />
                        </div>
                    </div>
                    <div class="well row">  <!--Location Data-->
						<table class="table table-bordered" id="location">
                            <tr>
                                <th width="15%">Flooding Type</th>
                                <th width="15%">Flooding Sub Type</th>
                                <th width="15%">Severity</th>
                                <th width="20%">Location</th>
                                <th width="25%">Comments</th>
                                 <th width="5%"></th>
                               
                            </tr>

		
                        </table>
                        <table>
                        
                        <TR><TD valign = "top" width="15%">
		<select class="feedback-input-table" id="LocationFloodType" name="LocationFloodType" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DL' AND coderef='FLO' AND LEVEL='2' ORDER BY CODEDESC">
                           			<option value="-1" disabled selected>[Select]</option>
        </select>                   			
		</TD><TD valign = "top" width="15%">
		<select class="feedback-input-table" id="LocationFloodSubType" name="LocationFloodSubType" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DL' AND coderef='FLS' AND LEVEL='2' ORDER BY CODEDESC">
                           			<option value="-1" disabled selected>[Select]</option>     
        </select>  
        </TD><TD valign = "top" width="15%">
		<select class="feedback-input-table" id="LocationSeverity" name="LocationSeverity" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DL' AND coderef='SEV' AND LEVEL='2' ORDER BY CODEDESC">
                           			<option value="-1" disabled selected>[Select]</option>
        </select> 
        </TD><TD valign = "top" width="20%">
        <input type="text" class="feedback-input-table" id="LocationFloc" />
        </TD><td valign = "top" width="25%">
        <textarea class="feedback-input-table"  id="LocationComments" name="LocationComments" rows="3" cols="40"></textarea></td>
        <TD valign = "top" width="5%"><button id="addnewlocation" onclick="addNewLocation()" type="button" class="btn btn-small btn-success pull-right">New</button></TD></TR>
                        </table>
                        
                    </div>
                    <div class="well row">  <!--Room Data-->
						<table class="table table-bordered" id="room">
                            <tr>
                                <th width="15%">Location</th>
                                <th width="30%">Room</th>
                                <th width="15%">Depth</th>
                                <th width="35%">Comments</th>
                                <th width="5%"></th>
                            </tr>
                        </table>
                        	<table >
	<TR>
	<TD valign="top" width="15%">
		<select class="feedback-input-table" id="RoomLocSelect" name="RoomLocSelect" >
                           			<option value="-1" disabled selected>[Select]</option>
                        		</select> 
		
		</TD><TD valign="top" width="30%">
		<select class="feedback-input-table" id="RoomSelect" name="RoomSelect" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DL' AND coderef='DRR' AND LEVEL='2' ORDER BY CODEDESC">
                           			<option value="-1" disabled selected>[Select]</option>
                        		</select> 
		</TD><TD valign="top" width="15%">
		<select class="feedback-input-table" id="DepthSelect" name="DepthSelect" merge="SELECT CODE as value, CODEDESC as description FROM DG5CODES WHERE type = 'DL' AND coderef='DRD' AND LEVEL='2' ORDER BY CODEDESC">
                           			<option value="-1" disabled selected>[Select]</option>
                        		</select>
        </TD><TD valign="top" width="35%">
        <textarea class="feedback-input-table" id="RoomComments" name="RoomComments" rows="4" cols="40"></textarea>
        </TD><TD valign="top" width="5%">
        
                        <button id="addnewroom" onclick="addNewRoom()" type="button" class="btn btn-small btn-success pull-right">New</button>
        </TD></TR></TABLE>            
                    </div>

                            <input type="submit" name="Save" value="SEND" id="Save" hidden />


                </div>

            </form>
        </div>
   
    </body>

    <script>
    function setLocationEmpty(){
    	document.getElementById("LocationFloodType").value="-1";
    	document.getElementById("LocationFloodSubType").value="-1";
    	document.getElementById("LocationSeverity").value="-1";
    	document.getElementById("LocationFloc").value="";
    	document.getElementById("LocationComments").value="";
    }
    function setRoomEmpty(){
    	document.getElementById("RoomLocSelect").value="-1";
    	
    	document.getElementById("RoomSelect").value="-1";
    	document.getElementById("DepthSelect").value="-1";
    	document.getElementById("RoomComments").value="";
    	
    }
    function refreshRoomsLocation(){
    	var select = document.getElementById("RoomLocSelect");
    	select.innerHTML="";

 	   $('#RoomLocSelect')
        	.append($("<option></option>")
        	.attr("value","-1")
        	.attr("selected",true)
        	.attr("disabled",true)
        	.text("[Select]")); 
 	 
    	var table = document.getElementById("location");
    	for (var i = 1, row; row = table.rows[i]; i++) {
    	   x=row.cells[3].innerHTML.split("<")
    	   
    	   $('#RoomLocSelect')
           	.append($("<option></option>")
           	.attr("value",x[0])
           	.text(x[0])); 
    	}
    	
    }
    function deleteRoomsForLoc(loc){
    	
    	var table = document.getElementById("room");
    	for (var i = table.rows.length-1; i>0; i--) {
    	   //iterate through rows
    	   //rows would be accessed using the "row" variable assigned in the for loop
    	   row = table.rows[i]
    	 
    	   roomloc=row.cells[0].innerHTML.split("<")
    	   if (roomloc[0]==loc) {
    		   
    		   document.getElementById("room").deleteRow(i);
    	   }
 
    	}
    	
    	refreshRoomsLocation()	
    }
    $("#attendancedate").datepicker({
        dateFormat: "dd/mm/yy"
    });    
    $("#flooddate").datepicker({
        dateFormat: "dd/mm/yy"
    });
    $(window).resize(function() {
    	
    	console.log("scrolling 1 to "+document.activeElement.id)
    		location.href="#"
    		location.href="#"+document.activeElement.id
 
    	});
    

    function addNewLocation() {
    	var rowCount = $('#location tr').length;
    	 if ((document.getElementById("LocationFloodType").value=="-1")||
         		(document.getElementById("LocationFloodSubType").value=="-1")||
         		(document.getElementById("LocationSeverity").value=="-1")||
         		(document.getElementById("LocationFloc").value.length<1)||
         		(document.getElementById("LocationFloc").value.length<1)){
         	return
         }
        $('#location tr:last').after('<tr><td>'+$("#LocationFloodType>option:selected").html()+'<input type="text" class="feedback-input-table" id="loctype' + rowCount + '" value="'+document.getElementById("LocationFloodType").value+'" hidden/></td><td>'+$("#LocationFloodSubType>option:selected").html()+'<input type="text" class="feedback-input-table" id="locsubtype' + rowCount + '" value="'+document.getElementById("LocationFloodSubType").value+'" hidden /></td><td>'+$("#LocationSeverity>option:selected").html()+'<input type="text" class="feedback-input-table" id="locseverity' + rowCount + '" value="'+document.getElementById("LocationSeverity").value+'" hidden /></td><td>'+document.getElementById("LocationFloc").value+'<input type="text" class="feedback-input-table" id="locfloc' + rowCount + '" value="'+document.getElementById("LocationFloc").value+'" hidden  /></td><td>'+document.getElementById("LocationComments").value+'<input type="text" class="feedback-input-table" id="loccomments' + rowCount + '" value="'+document.getElementById("LocationComments").value+'" hidden  /></td><TD><button onclick="deleteLocation('+rowCount+')" class="btn btn-small btn-danger">Del</button></TD></tr>');
        refreshRoomsLocation();
       
        setLocationEmpty()
        setRoomEmpty()
    }
  

    function addNewRoom() {
    	var rowCount = $('#room tr').length;
    	 if ((document.getElementById("RoomLocSelect").value=="-1")||
          		(document.getElementById("RoomSelect").value=="-1")||
          		(document.getElementById("DepthSelect").value=="-1")||
          	
          		(document.getElementById("RoomComments").value.length<1)){
          	return
          }
        $('#room tr:last').after('<tr><td>'+$("#RoomLocSelect>option:selected").html()+'<input type="text" class="feedback-input-table" id="roomloc' + rowCount + '" value="'+document.getElementById("RoomLocSelect").value+'" HIDDEN/></td><td>'+$("#RoomSelect>option:selected").html()+'<input type="text" class="feedback-input-table" id="roomroom' + rowCount + '" value="'+document.getElementById("RoomSelect").value+'" hidden /><td>'+$("#DepthSelect>option:selected").html()+'<input type="text" class="feedback-input-table" id="roomdepth' + rowCount + '" value="'+document.getElementById("DepthSelect").value+'" hidden /></td><td>'+document.getElementById("RoomComments").value+'<input type="text" class="feedback-input-table" id="roomcomments' + rowCount + '" value="'+document.getElementById("RoomComments").value+'" hidden /></td><TD><button onclick="deleteRoom('+rowCount+')" class="btn btn-small btn-danger">Del</button></TD></tr>');
        setRoomEmpty()
    }
    function deleteLocation(n){
    	var table = document.getElementById("location");
    	loctoDelete=table.rows[n].cells[3].innerHTML.split("<");
    	
    	document.getElementById("location").deleteRow(n);
    	deleteRoomsForLoc(loctoDelete[0])
    }
    function deleteRoom(n){
    	document.getElementById("room").deleteRow(n);
    }
    setLocationEmpty()
    setRoomEmpty()
    
function openGoogleMapsGetLocation(url){
//open win and turn off location 
var ref = window.open(url, '_blank', 'location=no');

// attach listener to loadstart
	ref.addEventListener('loadstart', function(event) { 
	    var urlSuccessPage = "http://mobileapp/close/";
	    if (event.url == urlSuccessPage) {
	    	document.getElementById("gridref").value=localStorage.getItem('mapLocation')
	    ref.close();    
	    }
	});
}
    </script>
</html>
